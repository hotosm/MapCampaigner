<div class="completness">
    <h3 class="progress-bar-indicator">{{ data.complete }}/{{ data.total }} ({{ data.percentage }} %)</h3>
    <div class="progress-bar-wrapper">
        <div class="progress-bar" style="width: {{ data.percentage }}%"></div>
    </div>
    <div class="see-detail" onclick="see_completeness_details(this)"><i class="fa fa-caret-up" aria-hidden="true"></i> hide list of incomplete features</div>
    <table class="feature-list-table">
        <thead>
        <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Status</th>
            {% for key in data.attributes %}
                <th>{{ key }}</th>
            {% endfor %}
        </tr>
        </thead>
        <tbody>
        {% for row in data.data %}
            {% if row['error'] %}
            <tr>
                <td>
                    <a target="_blank" href="http://www.openstreetmap.org/{{ row['type'] }}/{{ row['id'] }}">
                        {{ row['type'] }} :
                        {% if 'tags' in row %}
                            {% if row['tags']['name'] %}
                                {{ row['tags']['name'] }} ({{ row['id'] }})
                            {% else %}
                                {{ row['id'] }}
                            {% endif %}
                        {% else %}
                            {{ row['id'] }}
                        {% endif %}
                    </a>
                    {% if row['type'] == 'relation' %}
                        <span class="show-members">
                            <i class="fa fa-arrow-circle-down" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Show members"></i>
                        </span>
                        <div class="relation-member">
                        Members :
                        <ul>
                        {% for member in row['members'] %}
                            <li>
                            <a target="_blank" href="http://www.openstreetmap.org/{{ member['type'] }}/{{ member['ref'] }}">
                                {{ member['type'] }} : {{ member['ref'] }}
                            </a>
                            </li>
                        {% endfor %}
                        </ul>
                        </div>
                    {% endif %}
                </td>
                <td>
                    {{ row['type'] }} <ul>
                </ul>
                </td>
                <td>
                    {% if row['only_warning'] %}
                    {% else %}
                       <div class="error-completeness">Error: {{ row['error_message'] }}</div>
                    {% endif %}
                </td>
                {% for key in data.attributes %}
                    {% if not row['tags'] %}
                        <td>-</td>
                    {% elif row['tags'][key] %}
                        <td>{{ row['tags'][key] }}</td>
                    {% elif row[key] %}
                        <td>{{ row[key] }}</td>
                    {% else %}
                        <td>-</td>
                    {% endif %}
                {% endfor %}
            </tr>
            {% endif %}
        {% endfor %}
        </tbody>
    </table>
    <div class="footer">
        Data updated at {{ data['last_update'] }}.
        {% if data['updating'] %}
            <br>
            Currently updating.
        {% endif %}
    </div>
</div>
<style type="text/css">
    .see-detail {
        width: 100%;
        text-align: center;
        cursor: pointer;
        margin: 10px;
        padding-top: 20px;
    }

    .progress-bar-indicator {
        color: #77a1aa;
        margin-top: 0px;
    }

    .progress-bar-wrapper {
        background-color: #EBEBEB;
        border-radius: 50px;
        height: 10px;
    }

    .progress-bar-wrapper .progress-bar {
        height: 10px;
        background-color: #77a1aa;
        border-radius: 50px;
    }

    .completness .dataTables_wrapper {
        display: none;
    }

    .feature-list-table .error-indicator {
        background-color: #77a1aa;
        color: white;
    }

    .feature-list-table .clean-indicator {
        background-color: green;
        color: white;
    }

    tr.odd:hover, tr.even:hover {
        background-color: rgba(59, 132, 172, 0.13) !important;
    }

    tr.odd {
        background-color: rgba(223, 234, 242, 0.20) !important;
    }

    .show-members:hover {
        cursor: pointer;
    }

    .relation-member {
        display: none;
    }

    .error-completeness {
        color: #c90623;
    }
</style>
<script>
    $(document).tooltip({
        selector: "[data-toggle=tooltip]",
        container: "body"
    });
    var function_id = "{{ function_id }}";
    var $wrapper = $('#{{ function_id }}');
    $wrapper.find('.feature-list-table').DataTable({
        "bSortClasses": false
    });
    $wrapper.find('.dataTables_wrapper').show();
    function see_completeness_details(event) {
        if (!$(event).closest(".completness").find(".dataTables_wrapper").is(":visible")) {
            $(event).html('<i class="fa fa-caret-up" aria-hidden="true"></i> hide list of incomplete features');
            $(event).closest(".completness").find(".dataTables_wrapper").show();
        } else {
            $(event).html('<i class="fa fa-caret-down" aria-hidden="true"></i> see list of incomplete features');
            $(event).closest(".completness").find(".dataTables_wrapper").hide();
        }
    }
    $('.show-members').click(function (e) {
        if($(this).children().hasClass('fa-arrow-circle-down')) {
            $(this).siblings('.relation-member').show();
            $(this).children().removeClass('fa-arrow-circle-down');
            $(this).children().addClass('fa-arrow-circle-up');
            $(this).children().attr('data-original-title', 'Hide members');
        } else {
            $(this).siblings('.relation-member').hide();
            $(this).children().removeClass('fa-arrow-circle-up');
            $(this).children().addClass('fa-arrow-circle-down');
            $(this).children().attr('data-original-title', 'Show members');

        }
    });
</script>